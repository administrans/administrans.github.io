<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
    </style>
  </head>
  <body>
    <script src="texlive.js/promisejs/promise.js"></script>
    <script src="texlive.js/pdftex.js"></script>
    <h1>Trans administratif</h1>
    <h2>Nouvelle attestation de changement de prénom</h2>
    <script>
      allFields = [];
      function field(info) {
        document.write('<label for="'+info.id+'">'+info.label+'</label><input type="text" id="'+info.id+'" /><br />');
        allFields[allFields.length] = info.id;
      }
      field({ 'type': "text", 'id': "procurantfirstname", 'label': "Prénom (le vrai hein) de la personne trans" });
      field({ 'type': "text", 'id': "procurantlastname", 'label': "Nom de famille de la personne trans" });
      field({ 'type': "text", 'id': "procurantlistofname", 'label': "Liste des prénoms (les vrais) de la personne trans", 'placeholder': "Émilie, Delphine, Coralie" });
      field({ 'type': "date", 'id': "procurantdob", 'label': "Date de naissance de la personne trans" });
      field({ 'type': "text", 'id': "procurantpob", 'label': "Lieu et département de naissance de la personne trans", 'placeholder': "Nantes (Loire-Atlantique)" });
      field({ 'type': "text", 'id': "procurantaddress1", 'label': "Adresse" });
      field({ 'type': "text", 'id': "procurantaddress2", 'label': "Code postal et Ville" });
      field({ 'type': "selct", 'id': "procurantgender", 'label': "Accords de la personne", 'choices': ["féminin", "neutre", "masculin"] });
      field({ 'type': "text", 'id': "procurantville", 'label': "Ville dont la personne dépend pour l'État-Civil" });
      field({ 'type': "checkbox", 'id': "personignoredeadname", 'label': "La personne faisant l'attestation ignore le deadname" });
      field({ 'type': "text", 'id': "procurantdeadname", 'label': "Deadname de la personne (seulement le prénom) (et seulement si la personne connait le deadname)" });
      field({ 'type': "date", 'id': "date", 'label': "Date de l'attestation" });
      field({ 'type': "text", 'id': "personfirstname", 'label': "Prénom de la personne qui fait l'attestation" });
      field({ 'type': "text", 'id': "personlastname", 'label': "Nom de famille de la personne qui fait l'attestation" });
      field({ 'type': "text", 'id': "personlistofname", 'label': "Liste des prénoms de la personne qui fait l'attestation", 'placeholder': "Corentin, Sebastien, Pierre" });
      field({ 'type': "date", 'id': "persondob", 'label': "Date de naissance de la personne qui fait l'attestation" });
      field({ 'type': "text", 'id': "personpob", 'label': "Lieu et département de naissance de la personne qui fait l'attestation", 'placeholder': "Nantes (Loire-Atlantique)" });
      field({ 'type': "text", 'id': "persontelephone", 'label': "Numéro de téléphone", 'placeholder': "+33612345678" }); // regex=r'^(\+33|0|0033)\d{9}$',
      field({ 'type': "text", 'id': "personlocation", 'label': "Lieu où est faite la lettre" });
      field({ 'type': "text", 'id': "personemail", 'label': "Email de la personne qui fait l'attestation" });
      field({ 'type': "text", 'id': "personaddress1", 'label': "Adresse" });
      field({ 'type': "text", 'id': "personaddress2", 'label': "Code postal et Ville" });
      field({ 'type': "select", 'id': "persongender", 'label': "Accords de la personne", 'choices': ["féminin", "neutre", "masculin"] });
    </script>
    <pre id="latex_template1" style="display:none;">
\documentclass{article}

%-------------------------------------------------------------------------
%   Partie sur le. procurant.e
%-------------------------------------------------------------------------


% Mettre ici le prenom de la personne faisant la procuration
% et entre les {} le nom de famille
\newcommand{\ProcurantId}{$procurantfirstname$ {} \textsc{ $procurantlastname$ }}

% Mettre ici la suite des pr\'{e}noms de la personne faisant la procuration
% et entre les {} le nom de famille
\newcommand{\ProcurantFullId}{ $procurantlistofname$ {} \textsc{ $procurantlastname$ } }

\begin{document}
Hello \ProcurantId, blah \ProcurantFullId.
\end{document}
    </pre>
    <pre id="latex_template11" style="display:none;">
\documentclass[12pt,origdate]{lettre}%
%%%\usepackage[utf8x]{inputenc}
\usepackage[french]{babel}
%\usepackage[T1]{fontenc}
\usepackage{fontenc}
%\usepackage{mltex}
\begin{document}
%-----------------------------------------------%
% Le blabla pas int\'{e}ressant                     %
%-----------------------------------------------%
\begin{letter}{\`{A} l'attention du service d'\'{E}tat-Civil de \PersonLocation}
Hello
\end{letter}
\end{document}
    </pre>
    <pre id="latex_template" style="display:none;">
\documentclass[12pt,origdate]{lettre}%
%%%\usepackage[utf8x]{inputenc}
\usepackage[french]{babel}
%\usepackage[T1]{fontenc}
%\usepackage{mltex}

%-------------------------------------------------------------------------
%   Partie sur le. procurant.e
%-------------------------------------------------------------------------


% Mettre ici le prenom de la personne faisant la procuration
% et entre les {} le nom de famille
\newcommand{\ProcurantId}{$procurantfirstname$ {} \textsc{ $procurantlastname$ }}

% Mettre ici la suite des pr\'{e}noms de la personne faisant la procuration
% et entre les {} le nom de famille
\newcommand{\ProcurantFullId}{ $procurantlistofname$ {} \textsc{ $procurantlastname$ } }


% Mettre ici le num\'{e}ro, le type de voie et le nom de la voie
% de la personne faisant la procuration
\newcommand{\ProcurantAddresseRue}{ $procurantaddress1$ }

% Mettre ici le code postal (les 2 premiers chiffres avant le ~)
% et entre {} le nom de la ville
\newcommand{\ProcurantAddresseVille}{ $procurantaddress2$ }

% Ne pas toucher
\newcommand{\ProcurantAddressFull}{\ProcurantId\\\ProcurantAddresseRue\\\ProcurantAddresseVille}


% Mettre ici la date de naissance de la personne faisant la procuration
\newcommand{\ProcurantDOB}{ $procurantdob$ }

% Mettre ici la ville de naissance et entre () le d\'{e}partement de
% naissance de la personne faisant la procuration
\newcommand{\ProcurantPOB}{ $procurantpob$ }

% Malheureusement, pour des raisons d'idenfication, il faut mettre
% le deadname de la personne faisant la procuration et son nom de
% famille
\newcommand{\ProcurantOldId}{ $procurantdeadname$ {} \textsc{ $procurantlastname$ }}

% Mettre ici le num\'{e}ro de s\'{e}curit\'{e} sociale de la personne faisant
% la procuration
%\newcommand{\ProcurantSecu}{ $procurantss$ }


% Mettre ici le type d'accord souhait\'{e} pour la personne faisant
% la procuration.
% 0 = femme trans
% 1 = homme trans
\newcommand{\ProcurantGender}{ $procurantgender$ } % 0 = femme, 1 = homme


\newcommand{\Date}{ $date$ }

\newcommand{\ProcurantVille}{ $procurantville$ }
\newcommand{\PersonIgnoreDeadname}{ $personignoredeadname$ }
% Mettre ici le nom de l'\'{e}cole/universit\'{e}/autre \`{a} laquelle la demande
% de rectification et d'information est demand\'{e}e
%\newcommand{\ProcurantEcole}{ $procurantecole$ }

%-------------------------------------------------------------------------
%   Partie sur le. procur\'{e}.e
%-------------------------------------------------------------------------

% Mettre ici le pr\'{e}nom et le nom de famille entre {} de la personne
% faisant la d\'{e}marche
\newcommand{\PersonId}{ $personfirstname$ {} \textsc{ $personlastname$ }}

% Mettre ici tous les pr\'{e}noms de la personne faisant la d\'{e}marche et
% le nom de famille entre {}
\newcommand{\PersonFullId}{ $personlistofname$ {} \textsc{ $personlastname$ }}

% Mettre ici le num\'{e}ro de t\'{e}l\'{e}phone
\newcommand{\PersonTel}{ $persontelephone$ }

% Mettre ici : num\'{e}ro de la voie, type de voie, nom de la voie
\newcommand{\PersonAddresseRue}{ $personaddress1$ }

% Mettre ici le code postal et la ville
\newcommand{\PersonAddresseVille}{ $personaddress2$ }

% Ne pas toucher
\newcommand{\PersonAddressFull}{\PersonId\\\PersonAddresseRue\\\PersonAddresseVille}

% Mettre ici le nom de la ville d'où est \'{e}crit le courrier
\newcommand{\PersonLocation}{\textsc{ $personlocation$ }}

% Mettre ici le mail de la personne faisant les d\'{e}marches
\newcommand{\PersonEmail}{ $personemail$ }

% Mettre ici la date de naissance de la personne faisant les d\'{e}marches
\newcommand{\PersonDOB}{ $persondob$ }

% Mettre ici la ville et d\'{e}partement de naissance de la personne faisant
% les d\'{e}marches
\newcommand{\PersonPOB}{ $personpob$ }

% Pour les accords
% 0 = feminin
% 1 = masculun
\newcommand{\PersonGender}{ $persongender$ } % 0 = femme, 1 = homme


\begin{document}
%-----------------------------------------------%
% Le blabla pas int\'{e}ressant                     %
%-----------------------------------------------%
\begin{letter}{\`{A} l'attention du service d'\'{E}tat-Civil de \PersonLocation}

    \date{le \Date}
    \name{\PersonId}
    \address{\centering\PersonAddressFull}
    \telephone{\PersonTel}
    \nofax
    \lieu{\ProcurantVille}
    \signature{\PersonId}
    \email{\PersonEmail}

\conc{Attestation de changement de pr\'{e}nom pour une personne transgenre}
    \opening{Madame, Monsieur,}
%-----------------------------------------------%
% Le corps de la lettre de motivation           %
% \`{a} vous de jouer !                             %
%-----------------------------------------------%
%-% \`{a} remplacer par votre lettre de motivation
    Je\if\PersonGender0\ sous-sign\'{e}e \else\ sous-sign\'{e} \fi\PersonFullId{},\if\PersonGender0\ n\'{e}e \else\ n\'{e} \fi le \PersonDOB{} \`{a} \PersonPOB, demeurant au \PersonAddresseRue{} \PersonAddresseVille{} d\'{e}clare sur l'honneur\if\PersonIgnoreDeadname0%
    \ ignorer le pr\'{e}nom d'\'{E}tat-Civil de \ProcurantFullId{},
    \if\ProcurantGender0 n\'{e}e \else n\'{e} \fi le \ProcurantDOB{} \`{a} \ProcurantPOB{} et demeurant \`{a} \ProcurantAddresseRue{} \ProcurantAddresseVille{} et ne l'appeler que \ProcurantId
    \else\ n'appeler \ProcurantOldId
    \if\ProcurantGender0 n\'{e}e \else n\'{e} \fi le \ProcurantDOB{} \`{a} \ProcurantPOB{} et demeurant \`{a} \ProcurantAddresseRue{} \ProcurantAddresseVille{} que par son v\'{e}ritable pr\'{e}nom : \ProcurantFullId\fi.
%-----------------------------------------------%
% Le blabla pas int\'{e}ressant                     %
%-----------------------------------------------%
    \closing{Fait pour faire valoir ce que de droit,}
%-% \cc{Listes des autres destinataires}
    \encl{Copie d'une pi\`{e}ce d'identit\'{e} de \PersonId}
\end{letter}
\end{document}
    </pre>
    <script>
      function genpdf() {
        var source_code = document.getElementById('latex_template').innerText;
        for (var i = 0; i < allFields.length; i++) {
          source_code = source_code.replaceAll("$" + allFields[i] + "$", document.getElementById(allFields[i]).value);
        }
        console.log(source_code);
        var texlive = new TeXLive("texlive.js/");
        texlive.pdftex.set_TOTAL_MEMORY(80*1024*1024).then(function() {
          texlive.pdftex.on_stdout = console.log;
          texlive.pdftex.on_stderr = console.log;
          texlive.pdftex.compile(source_code).then(function(pdf_dataurl) {
            console.log(pdf_dataurl);
            if (pdf_dataurl === false) {
              console.log("compilation error");
            } else {
              window.open(pdf_dataurl);
            }
          });
        });
      }
    </script>
    <input type="button" onClick="genpdf();" value="genpdf" />
  </body>
</html>

